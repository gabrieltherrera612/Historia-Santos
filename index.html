<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Timeline de Apariciones y Santos</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f5f6fa;
  }

  /* Titulo */
  #titulo-timeline {
    text-align: center;
    font-family: 'Dancing Script', cursive;
    font-size: 28px; /* un poco más grande */
    font-weight: normal;
    margin: 20px 0;
    color: #333;
    background: rgba(135,206,250,0.3);
    padding: 12px;
    border-radius: 10px;
  }

  /* BLOQUE 1: Filtros + buscador */
  #panel-superior {
    display: flex;
    gap: 10px;
    padding: 12px;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    align-items: center;
    flex-wrap: wrap;
  }

  #filtros {
    display: flex;
    gap: 12px;
    flex-shrink: 0;
    font-size: 16px; /* texto más grande para los filtros */
  }

  #filtros label { font-weight: bold; }

  #buscador {
    flex: 1;
    max-width: 400px; /* más ancho */
    padding: 8px;
    font-size: 16px; /* más grande */
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  /* Timeline */
  #timeline {
    margin: 10px;
    height: auto;
    min-height: 350px; /* box más grande */
  }

  .evento {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .evento img {
    width: 35px;  
    height: 35px;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #ccc;
  }

  .evento span {
    font-size: 20px; /* texto más grande */
    font-weight: bold;
  }

  .evento.Jesus { color: #d9534f; font-weight: bold; }
  .evento.Virgen { color: #337ab7; }
  .evento.Santo { color: #5cb85c; }

  /* Detalle evento + imagen combinada */
  #detalle-seleccion {
    margin: 10px;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: none;
    font-size: 18px; /* texto más grande en el detalle */
  }

  #detalle-seleccion h3 {
    margin-top: 0;
    font-size: 24px; /* título más grande */
  }

  #detalle-content { text-align: justify; }

  #detalle-content img {
    float: left;
    width: 180px; /* imagen más grande */
    margin-right: 18px;
    margin-bottom: 12px;
    border-radius: 10px;
  }

  #detalle-qr { margin-top: 20px; clear: both; }

  @media (max-width: 768px) {
    #detalle-content img {
      float: none;
      display: block;
      width: 90%;
      margin: 0 auto 15px auto;
    }
    #buscador { max-width: 100%; font-size: 16px; padding: 8px; }
    #filtros { font-size: 14px; gap: 8px; }
    .evento span { font-size: 18px; }
    #detalle-seleccion { font-size: 16px; padding: 20px; }
    #detalle-seleccion h3 { font-size: 20px; }
  }
</style>
</head>
<body>

<div id="titulo-timeline">LINEA DE TIEMPO</div>

<div id="panel-superior">
  <div id="filtros">
    <label><input type="checkbox" id="filtro-jesus" checked> Jesus</label>
    <label><input type="checkbox" id="filtro-virgen" checked> Virgen</label>
    <label><input type="checkbox" id="filtro-santo" checked> Santo</label>
  </div>
  <input type="text" id="buscador" placeholder="Buscar... (ej: francis, asis, guadalupe)" />
</div>

<div id="timeline"></div>

<div id="detalle-seleccion">
  <h3 id="detalle-title"></h3>
  <p id="detalle-fecha"></p>
  <div id="detalle-content"></div>
  <div id="detalle-qr"></div>
</div>

<script>
const container = document.getElementById("timeline");
const dataset = new vis.DataSet([]);
let allData = [];

const options = {
  start: new Date(1000,0,1),
  end: new Date(2000,11,31),
  editable: false,
  autoResize: true,
  template: function(item) {
    return `<div class="evento ${item.categoria}">
        <img src="${item.img}" alt="${item.title}" />
        <span>${item.title}</span>
      </div>`;
  },
  tooltip: { followMouse: true }
};

const timeline = new vis.Timeline(container, dataset, options);

function limpiarTexto(texto) {
  return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

function renderizar() {
  const jesus = document.getElementById("filtro-jesus").checked;
  const virgen = document.getElementById("filtro-virgen").checked;
  const santo = document.getElementById("filtro-santo").checked;
  const busqueda = limpiarTexto(document.getElementById("buscador").value);

  const itemsFiltrados = allData.filter(item => {
    const categoriaOK = (item.categoria === "Jesus" && jesus) ||
                        (item.categoria === "Virgen" && virgen) ||
                        (item.categoria === "Santo" && santo);
    const textoOK = limpiarTexto(item.title).includes(busqueda);
    return categoriaOK && textoOK;
  });

  dataset.clear();
  dataset.add(itemsFiltrados);

  if(itemsFiltrados.length > 0){
    timeline.focus(itemsFiltrados[0].id, { animation: { duration: 500 } });
    timeline.setSelection(itemsFiltrados[0].id);
  }
}

fetch("eventos.json")
  .then(res => res.json())
  .then(data => {
    allData = data;
    dataset.add(allData);

    const hash = window.location.hash.substr(1);
    if(hash){
      const itemHash = allData.find(i => limpiarTexto(i.title).replace(/\s+/g,'-') === hash);
      if(itemHash){
        timeline.focus(itemHash.id, { animation: { duration: 500 } });
        timeline.setSelection(itemHash.id);
      }
    }
  })
  .catch(err => console.error("Error cargando eventos:", err));

document.getElementById("filtro-jesus").addEventListener("change", renderizar);
document.getElementById("filtro-virgen").addEventListener("change", renderizar);
document.getElementById("filtro-santo").addEventListener("change", renderizar);
document.getElementById("buscador").addEventListener("input", renderizar);

timeline.on("select", function(props) {
  if (props.items.length > 0) {
    const item = dataset.get(props.items[0]);
    document.getElementById("detalle-seleccion").style.display = "block";
    document.getElementById("detalle-title").textContent = item.title;
    document.getElementById("detalle-fecha").textContent = item.start;

    let contenidoHTML = `<img src="${item.img}" alt="${item.title}">${item.content}`;
    if(item.fuente){
      contenidoHTML += `<p><strong>Fuente:</strong> <a href="${item.fuente}" target="_blank">${item.fuente}</a></p>`;
    }
    document.getElementById("detalle-content").innerHTML = contenidoHTML;

    const qrDiv = document.getElementById("detalle-qr");
    qrDiv.innerHTML = "";
    const qrURL = `https://gabrieltherrera612.github.io/Historia-Santos/#${limpiarTexto(item.title).replace(/\s+/g,'-')}`;
    new QRCode(qrDiv, { text: qrURL, width: 120, height: 120 });
  }
});
</script>

</body>
</html>
